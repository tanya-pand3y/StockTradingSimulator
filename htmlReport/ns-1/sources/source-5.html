


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > Portfolio</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">entity</a>
</div>

<h1>Coverage Summary for Class: Portfolio (entity)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">Portfolio</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/28)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/91)
  </span>
</td>
</tr>
  <tr>
    <td class="name">Portfolio$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/28)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/96)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package entity;
&nbsp;
&nbsp;import data_access.StockQuantityDataAccessInterface;
&nbsp;
&nbsp;import java.text.ParseException;
&nbsp;import java.text.SimpleDateFormat;
&nbsp;import java.time.LocalDateTime;
&nbsp;import java.util.ArrayList;
&nbsp;import java.time.format.DateTimeFormatter;
&nbsp;import java.util.Collections;
&nbsp;import java.util.Comparator;
&nbsp;
&nbsp;
&nbsp;public class Portfolio {
&nbsp;    private final String username;
&nbsp;    private double portfolioValue;
&nbsp;    private double cash;
&nbsp;    private double PnL;
&nbsp;    private final ArrayList&lt;Holding&gt; holdings;
&nbsp;    private final StockQuantityDataAccessInterface stockQuantityDao;
&nbsp;
&nbsp;    private static double convertToDouble(Object number) {
<b class="nc">&nbsp;        if (number instanceof Double) {</b>
<b class="nc">&nbsp;            return (Double) number;</b>
<b class="nc">&nbsp;        } else if (number instanceof Long) {</b>
<b class="nc">&nbsp;            return ((Long) number).doubleValue();</b>
&nbsp;        } else {
<b class="nc">&nbsp;            throw new IllegalArgumentException(&quot;The input number is neither a Double nor a Long&quot;);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    public Portfolio (String username, StockQuantityDataAccessInterface dao){</b>
<b class="nc">&nbsp;        this.username = username;</b>
<b class="nc">&nbsp;        this.stockQuantityDao = dao;</b>
&nbsp;
<b class="nc">&nbsp;        dao.fetchData(this.username);</b>
<b class="nc">&nbsp;        this.holdings = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        this.stockQuantityDao.getPriceQuantityMap().forEach((ticker, dates) -&gt; {</b>
<b class="nc">&nbsp;            StockTransactionHistory stockTransactionHistory = new StockTransactionHistory();</b>
<b class="nc">&nbsp;            stockTransactionHistory.setTicker(ticker);</b>
<b class="nc">&nbsp;            dates.forEach((date, details) -&gt; {</b>
<b class="nc">&nbsp;                Transaction transaction = new Transaction(date, convertToDouble(details.get(&quot;Price&quot;)), (int)(long) details.get(&quot;Quantity&quot;));</b>
<b class="nc">&nbsp;                stockTransactionHistory.addTransaction(transaction);</b>
&nbsp;            });
<b class="nc">&nbsp;            Stock stock = new Stock(ticker);</b>
<b class="nc">&nbsp;            Holding holding = new Holding(stock,stockTransactionHistory);</b>
<b class="nc">&nbsp;            this.holdings.add(holding);</b>
&nbsp;        });
<b class="nc">&nbsp;        this.portfolioValue = 0.0;</b>
<b class="nc">&nbsp;        this.PnL = 0.0;</b>
<b class="nc">&nbsp;        this.cash = 5000;</b>
<b class="nc">&nbsp;        for (Holding holding : this.holdings) {</b>
<b class="nc">&nbsp;            this.portfolioValue += holding.getCurrentValue();</b>
<b class="nc">&nbsp;            this.PnL += holding.getPnL();</b>
<b class="nc">&nbsp;            this.cash -= holding.getStockTransactionHistory().getTotalTransactionValue();</b>
&nbsp;        }
&nbsp;
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Recalculates values in the portfolio
&nbsp;     */
&nbsp;    public void recalculate(){
<b class="nc">&nbsp;        this.portfolioValue = 0.0;</b>
<b class="nc">&nbsp;        this.PnL = 0.0;</b>
<b class="nc">&nbsp;        this.cash = 5000;</b>
<b class="nc">&nbsp;        for (Holding holding : this.holdings) {</b>
<b class="nc">&nbsp;            holding.recalculate();</b>
<b class="nc">&nbsp;            this.portfolioValue += holding.getCurrentValue();</b>
<b class="nc">&nbsp;            this.PnL += holding.getPnL();</b>
<b class="nc">&nbsp;            this.cash -= holding.getStockTransactionHistory().getTotalTransactionValue();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the username of the portfolio owner
&nbsp;     * @return the username of the portfolio owner
&nbsp;     */
&nbsp;    public String getUsername() {
<b class="nc">&nbsp;        return username;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Sets cash
&nbsp;     * @param cash the cash to set
&nbsp;     */
&nbsp;    public void setCash(double cash) {
<b class="nc">&nbsp;        this.cash = cash;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the amount of cash in the portfolio
&nbsp;     * @return the amount of cash in the portfolio
&nbsp;     */
&nbsp;    public double getCash() {
<b class="nc">&nbsp;        return cash;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the dollar value of profit/loss in the portfolio
&nbsp;     * @return the dollar value of profit/loss in the portfolio
&nbsp;     */
&nbsp;    public double getPnL() {
<b class="nc">&nbsp;        return PnL;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns a list of holdings in the portfolio
&nbsp;     * @return a list of holdings in the portfolio
&nbsp;     */
&nbsp;    public ArrayList&lt;Holding&gt; getHoldings() {
<b class="nc">&nbsp;        return holdings;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns a holding object corresponding to the string ticker input
&nbsp;     * @param ticker the ticker of the stock
&nbsp;     * @return a holding object of that stock, if found
&nbsp;     */
&nbsp;    public Holding getHolding (String ticker) {
<b class="nc">&nbsp;        for (Holding holding : holdings) {</b>
<b class="nc">&nbsp;            if (holding.getStock().getTicker().equals(ticker)) {</b>
<b class="nc">&nbsp;                return holding;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the quantity of a stock held in a portfolio
&nbsp;     * @param stock the stock to search for
&nbsp;     * @return the quantity of that stock in a holding in a portfolio
&nbsp;     */
&nbsp;    public int getQuantityByStock(Stock stock) {
<b class="nc">&nbsp;        for (Holding holding : holdings) {</b>
<b class="nc">&nbsp;            if (holding.getStock().equals(stock)) {</b>
<b class="nc">&nbsp;                return holding.getQuantity();</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return 0; // Return 0 if no holding with the given stock is found</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the dollar value of the portfolio
&nbsp;     * @return the dollar value of the portfolio
&nbsp;     */
&nbsp;    public double getPortfolioValue() {
<b class="nc">&nbsp;        return portfolioValue;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns a list of tickers corresponding to held stocks
&nbsp;     * @return a list of tickers corresponding to held stocks
&nbsp;     */
&nbsp;    public ArrayList&lt;String&gt; getHeldStocks(){
<b class="nc">&nbsp;        ArrayList&lt;String&gt; tickers = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        for (Holding holding : this.getPositiveQuantityHoldings()) {</b>
<b class="nc">&nbsp;            tickers.add(holding.getStock().getTicker());</b>
&nbsp;        }
<b class="nc">&nbsp;        return tickers;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Buys a given quantity of a stock given the ticker
&nbsp;     * @param ticker the ticker of stock
&nbsp;     * @param quantity the quantity of stock
&nbsp;     */
&nbsp;    public String buyStock(String ticker, int quantity){
<b class="nc">&nbsp;        Stock stock = new Stock(ticker);</b>
<b class="nc">&nbsp;        if (stock.getCurrentPrice()*quantity &gt; this.cash){</b>
<b class="nc">&nbsp;            System.out.println(&quot;Not enough money&quot;);</b>
<b class="nc">&nbsp;            return &quot;Insufficient funds!&quot;;</b>
&nbsp;        }
&nbsp;        else {
<b class="nc">&nbsp;            LocalDateTime currentDate = LocalDateTime.now();</b>
<b class="nc">&nbsp;            DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;);</b>
<b class="nc">&nbsp;            String formattedDate = currentDate.format(formatter);</b>
<b class="nc">&nbsp;            Transaction transaction = new Transaction(formattedDate, stock.getCurrentPrice(), quantity);</b>
<b class="nc">&nbsp;            if (this.getHolding(ticker) != null){</b>
<b class="nc">&nbsp;                Holding holding = this.getHolding(ticker);</b>
<b class="nc">&nbsp;                holding.addTransaction(transaction, username, this.stockQuantityDao);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                StockTransactionHistory stockTransactionHistory = new StockTransactionHistory();</b>
<b class="nc">&nbsp;                stockTransactionHistory.setTicker(ticker);</b>
<b class="nc">&nbsp;                Holding newHolding = new Holding(stock,stockTransactionHistory);</b>
<b class="nc">&nbsp;                newHolding.addTransaction(transaction, username, this.stockQuantityDao);</b>
<b class="nc">&nbsp;                holdings.add(newHolding);</b>
&nbsp;            }
<b class="nc">&nbsp;            this.cash -= stock.getCurrentPrice()*quantity;</b>
<b class="nc">&nbsp;            recalculate();</b>
&nbsp;        }
<b class="nc">&nbsp;        return &quot;&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Deletes a given quantity of a stock given the ticker
&nbsp;     * @param ticker the ticker of the stock
&nbsp;     * @param quantity the quantity of stock
&nbsp;     */
&nbsp;    public void deleteStocks(String ticker, Integer quantity){
<b class="nc">&nbsp;        Stock stock = new Stock(ticker);</b>
<b class="nc">&nbsp;        Holding holding = this.getHolding(ticker);</b>
<b class="nc">&nbsp;        if (holding.getQuantity() &lt; quantity){</b>
<b class="nc">&nbsp;            System.out.println(&quot;Not enough stocks&quot;);</b>
&nbsp;        }else {
<b class="nc">&nbsp;            LocalDateTime currentDate = LocalDateTime.now();</b>
<b class="nc">&nbsp;            DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;);</b>
<b class="nc">&nbsp;            String formattedDate = currentDate.format(formatter);</b>
<b class="nc">&nbsp;            Transaction transaction = new Transaction(formattedDate, stock.getCurrentPrice(), quantity * -1);</b>
<b class="nc">&nbsp;            holding.addTransaction(transaction, username, this.stockQuantityDao);</b>
<b class="nc">&nbsp;            this.cash += stock.getCurrentPrice() * quantity;</b>
<b class="nc">&nbsp;            recalculate();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns a list of holdings with a quantity greater than zero
&nbsp;     * @return a list of holdings with a quantity greater than zero
&nbsp;     */
&nbsp;    public ArrayList&lt;Holding&gt; getPositiveQuantityHoldings(){
<b class="nc">&nbsp;        ArrayList&lt;Holding&gt; holdings = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        for (Holding holding : this.holdings) {</b>
<b class="nc">&nbsp;            if (holding.getQuantity() &gt; 0) {</b>
<b class="nc">&nbsp;                holdings.add(holding);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return holdings;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the purchase history of the user, given a stock ticker
&nbsp;     * @param ticker the ticker of stock
&nbsp;     * @return the purchase history
&nbsp;     */
&nbsp;    public ArrayList&lt;Transaction&gt; getUserPurchaseHistory(String ticker) {
<b class="nc">&nbsp;        Holding holding = getHolding(ticker);</b>
<b class="nc">&nbsp;        ArrayList&lt;Transaction&gt; transactions = holding.getStockTransactionHistory().getTransactions();</b>
<b class="nc">&nbsp;        Collections.sort(transactions, new Comparator&lt;Transaction&gt;() {</b>
<b class="nc">&nbsp;            SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</b>
&nbsp;
&nbsp;            @Override
&nbsp;            public int compare(Transaction o1, Transaction o2) {
&nbsp;                try {
<b class="nc">&nbsp;                    return dateFormat.parse(o1.getDate()).compareTo(dateFormat.parse(o2.getDate()));</b>
<b class="nc">&nbsp;                } catch (ParseException e) {</b>
<b class="nc">&nbsp;                    throw new IllegalArgumentException(e);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return holding.getStockTransactionHistory().getTransactions();</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-08-08 13:55</div>
</div>
</body>
</html>
